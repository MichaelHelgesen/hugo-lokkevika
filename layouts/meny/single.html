{{ define "main" }}
{{ $strapi_url := (getenv "HUGO_strapi_url")}}
{{/* V5: Bruk populate=* */}}
{{ $strapi_single_types := print $strapi_url 
    "side-meny"
    "?populate[Topp][populate]=Bakgrunnsbilde"
}}
{{ $strapi_collection_meny := print $strapi_url 
    "menies?populate=*"
}}
{{ $opts := dict
    "headers" (dict "Authorization" (getenv "HUGO_strapi_bearer"))
}}
{{ $components := resources.GetRemote $strapi_single_types $opts | unmarshal }}
{{ $meny_liste := resources.GetRemote $strapi_collection_meny $opts | unmarshal}}

{{/* V5: Fjern .attributes */}}
{{ $comp_data := $components.data }}
{{ $title := $comp_data.Topp.Tittel}}

{{/* V5: Fjern .data.attributes fra media */}}
{{ $hero_bilde := $comp_data.Topp.Bakgrunnsbilde.formats.medium.url}}
{{ $ingres := $comp_data.Topp.Beskrivelse }}

{{/* V5: Fjern .data.attributes fra partial */}}
{{ partial "top.html" (dict "meny" $meny_liste "title" $title "img" $comp_data.Topp.Bakgrunnsbilde "ingres" $ingres) }}

<div class="meny--page" >
    <div class="absolute" style="background:url('{{ (resources.Get "/bilder/blomst-repeat.webp").RelPermalink }}')"></div>
    
    {{/* V5: Sort direkte p√• .rank, ikke .attributes.rank */}}
    {{ range sort $meny_liste.data ".rank" "asc" }}
        <div class="meny--wrapper">
            <div class="tittel">
                {{/* V5: Bruk .documentId i stedet for .id */}}
                <div class="ikon" id="{{ .documentId }}">
                    {{/* V5: Fjern .data.attributes fra Ikon */}}
                    <img src="{{ .Ikon.url }}" /> 
                </div>
                {{/* V5: Fjern .attributes */}}
                <h2>{{ .Tittel }}</h2>
                <p class="beskrivelse">{{ .Beskrivelse }}</p>
            </div>
            {{/* V5: Varer er direkte tilgjengelig */}}
            {{ range .Varer }}
                <div class="meny--wrapper_enhet">
                    <div class="meny--wrapper_enhet--beskrivelse">
                        <h3>{{ .Tittel }}</h3>
                        <p>{{ .Beskrivelse | markdownify }}</p>
                    </div>
                    {{ if .Pris }}
                        <div class="meny--wrapper_enhet--pris">
                            <p>Kr. <span>{{ .Pris }}</span>,-</p>
                        </div>
                    {{ else }}
                        <div class="meny--wrapper_enhet--pris">
                            <p><span>-</span></p>
                        </div>
                    {{ end }}
                </div>
            {{ end }}
        </div>
    {{ end }}
</div>
{{ end }}
